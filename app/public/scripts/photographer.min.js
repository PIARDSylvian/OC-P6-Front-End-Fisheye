class PhotographerModelPage extends AbstractModelPhotographer{constructor(e){super(e),this._picture="assets/photographers/Photographers ID Photos/"+e.portrait,this._id=e.id,this._city=e.city,this._country=e.country,this._tagline=e.tagline,this._price=e.price}getUserPageDOM(){return new PhotographerTemplatePage(this).getRender()}}class AbstractModelMedia{constructor(e,t){if(this.constructor===AbstractModelMedia)throw new TypeError('Abstract class "AbstractModelMedia" cannot be instantiated directly');this._date=e.date,this._id=e.id,this._likes=e.likes,this._photographerId=e.photographerId,this._photographerName=this.getFirstName(t),this._price=e.price,this._title=e.title}getFirstName(e){return e.split(" ")[0].replace("-"," ")}getMediaCardDOM(){var e=document.createElement("article"),t=document.createElement("h3"),r=(t.textContent=this._title,document.createElement("p"));return r.textContent=this._likes,e.appendChild(t),e.appendChild(r),e}}class PhotographerImageCard extends AbstractModelMedia{constructor(e,t){super(e,t),this._image=`assets/photographers/${this._photographerName}/`+e.image}getMediaCardDOM(){return new PhotographerTemplateImage(this).getRender()}}class PhotographerVideoCard extends AbstractModelMedia{constructor(e,t){super(e,t),this._video=`assets/photographers/${this._photographerName}/`+e.video}getMediaCardDOM(){return new PhotographerTemplateVideo(this).getRender()}}class PhotographerTemplatePage extends AbstractTemplatePhotographer{constructor(e){super(e),this._id=e._id,this._city=e._city,this._country=e._country,this._tagline=e._tagline,this._price=e._price}getRender(){var e=super.getRender(),t=e.querySelector("img"),r=(t.setAttribute("alt",this._name),t.classList.add("photographer__picture"),document.createElement("div")),e=e.querySelector("h2"),e=(e.classList.add("photographer__title"),r.appendChild(e),document.createElement("p")),e=(e.textContent=this._city+", "+this._country,e.classList.add("photographer__location"),r.appendChild(e),document.createElement("p")),e=(e.textContent=this._tagline,e.classList.add("photographer__tagline"),r.appendChild(e),document.createElement("p"));return e.textContent=this._price+"€ / jour",e.classList.add("photographer__price"),{image:t,info:r,price:e}}}class AbstractTemplateMedia{constructor(e){if(this.constructor===AbstractTemplateMedia)throw new TypeError('Abstract class "AbstractTemplateMedia" cannot be instantiated directly');this._date=e._date,this._id=e._id,this._likes=e._likes,this._photographerId=e._photographerId,this._photographerName=e._photographerName,this._price=e._price,this._title=e._title}getRender(){var e=document.createElement("figure"),t=document.createElement("figcaption"),r=(t.innerText=this._title,document.createElement("div")),a=(r.classList.add("like_count"),document.createElement("p")),a=(a.innerText=this._likes,r.appendChild(a),document.createElement("input")),i=(a.setAttribute("type","image"),a.setAttribute("src","assets/icons/heart.svg"),a.setAttribute("alt","like"),document.createElement("a"));return i.setAttribute("href","#"),i.setAttribute("id","media-"+this._id),i.setAttribute("role","button"),i.setAttribute("aria-label","Afficher en grand"),r.appendChild(a),{figure:e,figcaption:t,like:r,link:i}}}class PhotographerTemplateImage extends AbstractTemplateMedia{constructor(e){super(e),this._image=e._image}getRender(){var{figure:e,figcaption:t,like:r,link:a}=super.getRender(),i=document.createElement("img");return i.setAttribute("src",this._image),i.setAttribute("alt",this._title),a.appendChild(i),e.appendChild(a),e.appendChild(t),e.appendChild(r),e}}class PhotographerTemplateVideo extends AbstractTemplateMedia{constructor(e){super(e),this._video=e._video}getRender(){var{figure:e,figcaption:t,like:r,link:a}=super.getRender(),i=document.createElement("video"),d=document.createElement("source");return d.setAttribute("src",this._video),d.setAttribute("type","video/mp4"),i.appendChild(d),a.appendChild(i),e.appendChild(a),e.appendChild(t),e.appendChild(r),e}}function mediaFactory(e,t){if(e.image)return new PhotographerImageCard(e,t);if(e.video)return new PhotographerVideoCard(e,t);throw"Unknown media format"}class CustomSelect{constructor(e,t,r){this._data=r,this._id=e,this._name=t,this._idx=0}createOption(){const a=document.createElement("ul");return a.setAttribute("id","listbox_"+this._id),a.setAttribute("role","listbox"),a.setAttribute("aria-labelledby","label_"+this._id),a.setAttribute("tabindex",-1),this._data.map((e,t)=>{var r=document.createElement("li");r.setAttribute("id",this._id+"_"+t),r.setAttribute("role","option"),r.setAttribute("aria-selected",""+(0===t)),r.dataset.value=t,r.innerText=e,0===t&&r.classList.add("select"),a.append(r)}),a}keydown(e,t){switch(e){case"ArrowDown":return this._idx==t.length-1?this.changeSelect(0,t):this.changeSelect(this._idx+1,t),!0;case"ArrowUp":return 0==this._idx?this.changeSelect(t.length-1,t):this.changeSelect(this._idx-1,t),!0;case"Enter":case" ":return this.changeSelected(t[this._idx],t),!1;default:return!1}}changeSelect(e,t){this._idx=e,t.forEach((e,t)=>{t!==this._idx?e.classList.remove("select"):e.classList.add("select")})}changeSelected(t,e){const r=document.querySelector("#listbox_"+this._id);e.forEach(e=>{e!==t&&r.appendChild(e)}),"false"===t.getAttribute("aria-selected")&&e.forEach(e=>e.setAttribute("aria-selected",t.id===e.id))}createSelect(){var e=document.createElement("label");e.innerText=this._name,e.setAttribute("id","label_"+this._id),e.setAttribute("for",this._id);const t=document.createElement("button"),r=(t.setAttribute("id",this._id),t.setAttribute("role","button"),t.setAttribute("aria-haspopup","listbox"),t.setAttribute("aria-expanded",!1),t.setAttribute("aria-controls","listbox_"+this._id),t.setAttribute("aria-labelledby","label_"+this._id),t.setAttribute("tabindex",0),t.setAttribute("type","button"),t.innerText=this._data[0],this.createOption());var a=document.createElement("div");return a.classList.add("custom_select"),a.append(e,t,r),t.addEventListener("blur",function(){r.classList.contains("is-open")&&(t.style.zIndex=-1)}),r.addEventListener("blur",function(){r.classList.remove("is-open"),r.style.height="3em",t.style.zIndex=2,this._idx=0,t.innerText=r.querySelector('li[aria-selected="true"]').innerText,t.setAttribute("aria-expanded",!1)}),t.addEventListener("click",e=>{r.classList.add("is-open"),r.style.height="9em",t.setAttribute("aria-expanded",!0),1==e.pointerId&&r.querySelector("li").classList.remove("select"),r.focus()}),r.addEventListener("keydown",e=>{e.preventDefault();var t=r.querySelectorAll("li");this.keydown(e.key,t)||r.blur()}),r.addEventListener("click",e=>{var t=r.querySelectorAll("li");this.changeSelected(e.target,t),r.blur()}),a}}function addModal(e,t,r=()=>{},a=()=>{}){const i=document.querySelector("main"),d=document.createElement("div"),n=(d.setAttribute("role","dialog"),d.setAttribute("aria-hidden",!0),d.setAttribute("id",t),d.classList.add("modal"),document.createElement("input"));n.setAttribute("type","image"),n.setAttribute("src","assets/icons/close.svg"),n.setAttribute("alt","close"),d.appendChild(n),e.length?e.forEach(e=>d.appendChild(e)):d.appendChild(e),document.addEventListener("click",()=>{document.querySelector(".modal.open[aria-hidden='false']")&&n.click()}),d.addEventListener("click",e=>e.stopPropagation()),n.addEventListener("click",e=>{e.preventDefault(),a(e),i.setAttribute("aria-hidden",!1),d.setAttribute("aria-hidden",!0),d.classList.remove("open"),document.body.style.overflow="auto"});return document.body.appendChild(d),e=>{e.preventDefault(),document.querySelector(".modal.open[aria-hidden='false']")||(r(e),document.body.style.overflow="hidden",i.setAttribute("aria-hidden",!0),d.setAttribute("aria-hidden",!1),d.style.top=`calc(50% + ${window.scrollY}px)`,setTimeout(()=>d.classList.add("open"),10),n.focus())}}function addCarouselBase(){const t=document.createElement("div");t.classList.add("carousel"),t.dataset.idx=0;var e=document.createElement("button"),r=(e.setAttribute("aria-label","Media precedent"),e.innerText="<",document.createElement("button"));r.setAttribute("aria-label","Media suivant"),r.innerText=">";const a=document.createElement("div");return a.classList.add("carousel__content"),t.append(e,a,r),e.addEventListener("click",()=>{elements=a.querySelectorAll(".carousel__content>*");var e=+t.dataset.idx-1;t.dataset.idx=e<0?elements.length-1:e,elements.forEach(e=>{e.dataset.order===t.dataset.idx?e.setAttribute("aria-hidden",!1):e.setAttribute("aria-hidden",!0)})}),r.addEventListener("click",()=>{elements=a.querySelectorAll(".carousel__content>*");var e=+t.dataset.idx+1;e>elements.length-1?t.dataset.idx=0:t.dataset.idx=e,elements.forEach(e=>{e.dataset.order===t.dataset.idx?e.setAttribute("aria-hidden",!1):e.setAttribute("aria-hidden",!0)})}),t}function getUrlParmeterId(){return window.location.hash.substring(1)}async function getPhotographer(r){return await getPhotographers().then(e=>{var t=e.photographers.find(e=>e.id==r);return t.media=e.media.filter(e=>e.photographerId==r),t})}function addContactForm(e){var t=document.createElement("header"),r=document.createElement("h1"),e=(r.innerHTML="Contactez-moi <br>"+e,t.append(r),document.createElement("form")),r=document.createElement("label"),a=(r.innerText="Prénom",r.setAttribute("for","firstName"),document.createElement("input")),i=(a.id="firstName",document.createElement("label")),d=(i.innerText="Nom",i.setAttribute("for","lastName"),document.createElement("input")),n=(d.id="lastName",document.createElement("label")),o=(n.innerText="Email",n.setAttribute("for","email"),document.createElement("input")),s=(o.id="email",document.createElement("label")),c=(s.innerText="Votre message",s.setAttribute("for","message"),document.createElement("textarea")),l=(c.id="message",document.createElement("input"));return l.type="submit",l.value="Envoyer",e.append(r,a,i,d,n,o,s,c,l),e.addEventListener("submit",e=>{e.preventDefault(),e.target.querySelectorAll("input:not([type='submit']), textarea").forEach(e=>console.log(e.value))}),[t,e]}function sortMedia(e,t){switch(t){case"2":e.sort((e,t)=>e.title<t.title?-1:e.title>t.title?1:0);break;case"1":e.sort((e,t)=>new Date(t.date)-new Date(e.date));break;default:e.sort((e,t)=>t.likes-e.likes)}return e}function addMedia(t,n,o){const s=document.querySelector(".photographer__section__media-wrapper"),r=(t=sortMedia(t),s.dataset.sort="0",t.forEach((e,t)=>{const r=mediaFactory(e,n).getMediaCardDOM();r.dataset.idx=t,r.dataset.order=t,r.dataset.id=e.id;var a=r.querySelector("a"),a=(a.addEventListener("click",e=>o(e)),a.cloneNode(!0).querySelector("img, video")),i=("VIDEO"===a.tagName&&a.setAttribute("controls",""),document.createElement("h3")),d=(i.innerText=r.getElementsByTagName("figcaption")[0].innerText,document.createElement("div"));d.append(a,i),d.setAttribute("aria-hidden",!0),d.dataset.idx=t,d.dataset.order=t,d.dataset.id=e.id,0==t&&d.setAttribute("aria-hidden",!1),document.querySelector(".carousel__content").append(d),r.querySelector(".like_count input").addEventListener("click",()=>{var e=+(likeCount=r.querySelector(".like_count p")).innerText;e++,likeCount.innerText=e,document.querySelector(".photographer__like-and-price div p").innerText++}),s.appendChild(r)}),document.querySelector("#listbox_sort_by"));r.addEventListener("blur",function(){var e=r.querySelector('li[aria-selected="true"]').dataset.value,e=sortMedia(t,e);count=5,e.forEach((e,t)=>{document.querySelector(`.photographer__section__media-wrapper figure[data-id="${e.id}"] a`).setAttribute("tabindex",count),count++,document.querySelector(`.photographer__section__media-wrapper figure[data-id="${e.id}"] input`).setAttribute("tabindex",count),count++,document.querySelector(`.photographer__section__media-wrapper figure[data-id="${e.id}"]`).style.order=t,document.querySelector(`.photographer__section__media-wrapper figure[data-id="${e.id}"]`).dataset.order=t,document.querySelector(`#carousel_modal .carousel__content div[data-id="${e.id}"]`).dataset.order=t}),document.querySelector("#label_sort_by").focus()})}function addTotalLikeAndPrice(e,t){var r=document.createElement("div"),a=(r.classList.add("photographer__like-and-price"),document.createElement("div")),i=document.createElement("p"),e=(i.innerText=e,document.createElement("img"));e.setAttribute("src","assets/icons/heart.svg"),e.setAttribute("alt","like"),a.appendChild(i),a.appendChild(e),r.appendChild(a),r.appendChild(t),document.querySelector("main").append(r)}async function displayData(e){var t=document.querySelector(".photographer__header"),r=photographerFactory(e,e.id).getUserPageDOM();t.prepend(r.info),t.append(r.image);let a=0;e.media.forEach(e=>a+=e.likes),addTotalLikeAndPrice(a,r.price);t=addModal(addCarouselBase(),"carousel_modal",e=>{{const t=document.querySelector(".modal .carousel");t.dataset.idx=e.composedPath().find(e=>"FIGURE"===e.tagName).dataset.order,t.querySelectorAll(".carousel__content>div").forEach(e=>{e.dataset.order==t.dataset.idx?e.setAttribute("aria-hidden",!1):e.setAttribute("aria-hidden",!0)})}},e=>{{const t=document.querySelector("#carousel_modal .carousel").dataset.idx;document.querySelectorAll(".photographer__section__media-wrapper figure").forEach(e=>{e.dataset.order===t&&e.querySelector("a").focus()})}});addMedia(e.media,e.name,t);const i=addModal(addContactForm(e.name),"contact_modal",()=>{},()=>{document.querySelector("#contact_modal form").reset(),document.querySelector(".photographer__header .contact_button").focus()});document.querySelector(".photographer__header .contact_button").addEventListener("click",e=>i(e))}async function init(){var e=await getPhotographer(getUrlParmeterId()),t=new CustomSelect("sort_by","Trier par",["Popularité","Date","Titre"]).createSelect();t.querySelector("#sort_by").setAttribute("tabindex","3"),document.querySelector(".photographer__section nav").append(t),displayData(e)}init();